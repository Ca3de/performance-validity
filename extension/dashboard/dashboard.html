<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AA Performance Validity Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <h1 class="app-title">
          <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
          AA Performance Validity
        </h1>
        <span class="warehouse-badge" id="warehouseBadge">Loading...</span>
      </div>
      <div class="header-right">
        <div class="date-range-picker">
          <select id="periodSelect" class="period-select">
            <option value="today">Today / Current Shift</option>
            <option value="week">This Week</option>
            <option value="lastWeek">Last Week</option>
            <option value="month" selected>This Month</option>
            <option value="lastMonth">Last Month</option>
            <option value="custom">Custom Range</option>
          </select>
          <select id="shiftSelect" class="shift-select" title="Filter by shift">
            <option value="all">All Shifts</option>
            <option value="day">Day Shift (6AM-6PM)</option>
            <option value="night">Night Shift (6PM-6AM)</option>
          </select>
          <div id="customDateRange" class="custom-date-range" style="display: none;">
            <input type="date" id="startDate" />
            <span>to</span>
            <input type="date" id="endDate" />
          </div>
          <button class="btn btn-primary" id="applyDateRange">Load Data</button>
        </div>
        <button class="btn btn-secondary" id="refreshBtn">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
          </svg>
          Refresh
        </button>
      </div>
    </header>

    <!-- Search and Filter Bar -->
    <div class="filter-bar">
      <div class="search-box">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input type="text" id="employeeSearch" placeholder="Search by Employee ID or Name..." />
      </div>
      <div class="filter-pills" id="pathFilters">
        <!-- Path filter pills will be generated by JS -->
      </div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Summary Cards -->
      <div class="summary-cards" id="summaryCards">
        <div class="summary-card">
          <div class="card-icon" style="background: #E3F2FD; color: #1976D2;">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-value" id="totalEmployees">0</div>
            <div class="card-label">Total AAs</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="card-icon" style="background: #E8F5E9; color: #2E7D32;">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-value" id="meetingGoal">0</div>
            <div class="card-label">Meeting Goal</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="card-icon" style="background: #FFF3E0; color: #E65100;">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-value" id="belowGoal">0</div>
            <div class="card-label">Below Goal</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="card-icon" style="background: #F3E5F5; color: #7B1FA2;">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
            </svg>
          </div>
          <div class="card-content">
            <div class="card-value" id="totalPaths">0</div>
            <div class="card-label">Active Paths</div>
          </div>
        </div>
      </div>

      <!-- AA Lookup Section -->
      <div class="aa-lookup-section">
        <h3>
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
          </svg>
          AA Lookup
        </h3>
        <div class="lookup-row">
          <div class="lookup-input-wrapper">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" class="scan-icon">
              <path d="M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm13-2h-2v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/>
            </svg>
            <input type="text" id="aaLookupInput" placeholder="Scan badge or enter ID / Name..." autofocus />
            <button class="btn btn-icon" id="clearLookupBtn" title="Clear">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
          <select id="lookupPathSelect" class="path-select">
            <option value="all">All Paths</option>
            <option value="pick">Pick</option>
            <option value="pack">Pack</option>
            <option value="stow">Stow</option>
          </select>
          <button class="btn btn-primary" id="lookupBtn">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
            Lookup
          </button>
        </div>
      </div>

      <!-- AA Detail Panel (hidden by default) - Game-style Player Card -->
      <div class="aa-detail-panel player-card" id="aaDetailPanel" style="display: none;">
        <div class="card-header">
          <div class="player-rating-circle" id="overallRating">
            <span class="rating-value">--</span>
            <span class="rating-label">OVR</span>
          </div>
          <div class="player-info">
            <h2 class="player-name" id="aaDetailName">Employee Name</h2>
            <div class="player-meta">
              <span class="badge-id" id="aaDetailId">Badge: --------</span>
              <span class="player-position" id="aaDetailPath">Pick</span>
            </div>
          </div>
          <button class="btn btn-icon close-btn" id="closeDetailBtn" title="Close">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>

        <!-- Performance Tier Badge -->
        <div class="tier-badge" id="tierBadge">
          <span class="tier-icon">⭐</span>
          <span class="tier-name" id="tierName">Rookie</span>
        </div>

        <!-- Main Stats - FIFA/FM Style -->
        <div class="player-stats-grid">
          <div class="stat-hexagon" data-stat="speed">
            <div class="stat-value" id="statJPH">--</div>
            <div class="stat-name">JPH</div>
            <div class="stat-bar"><div class="stat-fill" id="statBarJPH"></div></div>
          </div>
          <div class="stat-hexagon" data-stat="jobs">
            <div class="stat-value" id="statJobs">--</div>
            <div class="stat-name">JOBS</div>
            <div class="stat-bar"><div class="stat-fill" id="statBarJobs"></div></div>
          </div>
          <div class="stat-hexagon" data-stat="hours">
            <div class="stat-value" id="statHours">--</div>
            <div class="stat-name">HRS</div>
            <div class="stat-bar"><div class="stat-fill" id="statBarHours"></div></div>
          </div>
          <div class="stat-hexagon" data-stat="efficiency">
            <div class="stat-value" id="statEfficiency">--</div>
            <div class="stat-name">EFF%</div>
            <div class="stat-bar"><div class="stat-fill" id="statBarEfficiency"></div></div>
          </div>
        </div>

        <!-- Comparison vs Path Average -->
        <div class="vs-comparison">
          <div class="vs-header">
            <span class="vs-title">VS PATH AVERAGE</span>
            <span class="vs-path" id="vsPathName">Pick</span>
          </div>
          <div class="vs-stats">
            <div class="vs-stat">
              <span class="vs-label">Your JPH</span>
              <span class="vs-value highlight" id="vsYourJPH">--</span>
            </div>
            <div class="vs-divider">
              <span class="vs-icon">⚔️</span>
            </div>
            <div class="vs-stat">
              <span class="vs-label">Avg JPH</span>
              <span class="vs-value" id="vsAvgJPH">--</span>
            </div>
          </div>
          <div class="vs-result" id="vsResult">
            <span class="vs-diff" id="vsDiff">+0.0</span>
            <span class="vs-text" id="vsText">above average</span>
          </div>
        </div>

        <!-- Ranking with Leaderboard Style -->
        <div class="leaderboard-rank">
          <div class="rank-display">
            <span class="rank-hash">#</span>
            <span class="rank-number" id="rankNumber">--</span>
          </div>
          <div class="rank-context">
            <span class="rank-of">of <span id="rankTotal">--</span></span>
            <span class="rank-path" id="rankDescription">in Pick by JPH</span>
          </div>
          <div class="rank-percentile" id="rankPercentile">
            <span class="percentile-value">--</span>
            <span class="percentile-label">percentile</span>
          </div>
        </div>

        <!-- Sub-Path Breakdown (Expandable) -->
        <div class="subpath-section">
          <button class="subpath-toggle" id="subpathToggle">
            <span class="toggle-icon">▶</span>
            <span class="toggle-text">Sub-Path Breakdown</span>
            <span class="subpath-count" id="subpathCount">0 paths</span>
          </button>
          <div class="subpath-details" id="subpathDetails" style="display: none;">
            <div class="subpath-list" id="subpathList">
              <!-- Generated by JS -->
            </div>
          </div>
        </div>

        <!-- Path History (if multiple paths) -->
        <div class="path-history" id="pathHistory" style="display: none;">
          <h3>
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
            </svg>
            All Paths Worked
          </h3>
          <div class="path-history-table" id="pathHistoryTable">
            <!-- Generated by JS -->
          </div>
        </div>
      </div>

      <!-- Employee Input Section -->
      <div class="employee-input-section">
        <h3>Add Employees to Check</h3>
        <div class="input-row">
          <textarea id="employeeInput" placeholder="Enter employee IDs or logins (one per line or comma-separated)..."></textarea>
          <button class="btn btn-primary" id="addEmployeesBtn">Add Employees</button>
        </div>
      </div>

      <!-- Performance Table -->
      <div class="table-container">
        <div class="table-header">
          <h2>Performance by Path</h2>
          <div class="table-actions">
            <button class="btn btn-outline" id="exportCsvBtn">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
              </svg>
              Export CSV
            </button>
            <select id="sortSelect">
              <option value="employee">Sort by Employee</option>
              <option value="path">Sort by Path</option>
              <option value="rate">Sort by JPH</option>
              <option value="hours">Sort by Hours</option>
            </select>
          </div>
        </div>
        <div class="table-wrapper">
          <table id="performanceTable">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Path</th>
                <th>Hours</th>
                <th>Jobs</th>
                <th>JPH</th>
                <th>Goal</th>
                <th>% to Goal</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="performanceBody">
              <tr class="empty-state">
                <td colspan="9">
                  <div class="empty-message">
                    <svg viewBox="0 0 24 24" width="48" height="48" fill="currentColor" opacity="0.3">
                      <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    <p>No performance data loaded</p>
                    <p class="hint">Add employees above or click "AA Performance" on FCLM to load data</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Path Breakdown Section -->
      <div class="path-breakdown" id="pathBreakdown">
        <h2>Path Summary</h2>
        <div class="path-cards" id="pathCards">
          <!-- Path cards will be generated by JS -->
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
      <span>AA Performance Validity v1.0.0</span>
      <span>|</span>
      <a href="https://github.com/Ca3de/performance-validity" target="_blank">GitHub</a>
    </footer>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p>Loading performance data...</p>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="dashboard.js"></script>
</body>
</html>
